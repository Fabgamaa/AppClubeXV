using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;

namespace FWBDS


{
    public class Afinidade
    {

        #region Propriedades

        private int? _AFN_ID;
        private DateTime? _AFN_DAT;
        private string _AFN_SEM;
        private int? _AFN_TIP;
        private int? _AFN_TIT_POY_ID;
        private string _AFN_LOT;
        private string _AFN_MGE_001;
        private string _AFN_MGE_002;
        private string _AFN_MGE_003;
        private string _AFN_MGE_004;
        private int? _AFN_FOR_001_ID;
        private int? _AFN_FOR_002_ID;
        private int? _AFN_FOR_003_ID;
        private int? _AFN_FOR_004_ID;
        private int? _AFN_VLC;
        private int? _AFN_APS_ID;
        private int? _AFN_MAQ_TIP_ID;
        private int? _AFN_MAQ_ID;
        private int? _AFN_ERT_ID;
        private int? _AFN_VRD;
        private int? _AFN_BBN;
        private int? _AFN_ANA_USR_ID;
        private double? _AFN_CLO;
        private double? _AFN_ESU;
        private double? _AFN_TMT;
        private double? _AFN_PMT;
        private double? _AFN_PPF;
        private double? _AFN_BBB;
        private double? _AFN_PFE;
        private double? _AFN_PSE;
        private double? _AFN_LNE;
        private double? _AFN_LNC;
        private double? _AFN_ESL;
        private double? _AFN_TOT;
        private int? _AFN_STS;
        private int? _AFN_USR_INC_ID;
        private int? _AFN_USR_ALT_ID;
        private DateTime? _AFN_TMS_ATL;
        private DateTime? _AFN_DAT_INI;
        private DateTime? _AFN_DAT_FIM;
        //private int? _AFN_POS;
        //private string _AFN_DEF;
        private DateTime? _AFN_DAT_MEIA;
        private string _AFN_RES_MEIA;
        private DateTime? _AFN_DAT_TIN;
        private int? _AFN_ANA_TIN_ID;
        private DateTime? _AFN_DAT_LEI;
        private int? _AFN_ANA_LEI_ID;
        private DateTime? _AFN_DAT_LIB;
        private int? _AFN_ANA_LIB_ID;
        private string _AFN_DEF;
        private string _AFN_OBS;
        private int? _AFN_GLA;
        private string _TOP;
        private string _SQL;


        //public int? AFN_POS
        //{
        //    get { return _AFN_POS; }
        //    set { _AFN_POS = value; }
        //}
        public string AFN_DEF
        {
            get { return _AFN_DEF; }
            set { _AFN_DEF = value; }
        }
        public string AFN_OBS
        {
            get { return _AFN_OBS; }
            set { _AFN_OBS = value.ToUpper(); }
        }
        public DateTime? AFN_DAT_MEIA
        {
            get { return _AFN_DAT_MEIA; }
            set { _AFN_DAT_MEIA = value; }
        }
        public DateTime? AFN_DAT_TIN
        {
            get { return _AFN_DAT_TIN; }
            set { _AFN_DAT_TIN = value; }
        }
        public DateTime? AFN_DAT_LEI
        {
            get { return _AFN_DAT_LEI; }
            set { _AFN_DAT_LEI = value; }
        }
        public DateTime? AFN_DAT_LIB
        {
            get { return _AFN_DAT_LIB; }
            set { _AFN_DAT_LIB = value; }
        }
        public string AFN_RES_MEIA
        {
            get { return _AFN_RES_MEIA; }
            set { _AFN_RES_MEIA = value; }
        }
        public int? AFN_GLA
        {
            get { return _AFN_GLA; }
            set { _AFN_GLA = value; }
        }
        public int? AFN_ANA_TIN_ID
        {
            get { return _AFN_ANA_TIN_ID; }
            set { _AFN_ANA_TIN_ID = value; }
        }
        public int? AFN_ANA_LEI_ID
        {
            get { return _AFN_ANA_LEI_ID; }
            set { _AFN_ANA_LEI_ID = value; }
        }
        public int? AFN_ANA_LIB_ID
        {
            get { return _AFN_ANA_LIB_ID; }
            set { _AFN_ANA_LIB_ID = value; }
        }     
        public int? AFN_ID
        {
            get { return _AFN_ID; }
            set { _AFN_ID = value; }
        }
        public DateTime? AFN_DAT
        {
            get { return _AFN_DAT; }
            set { _AFN_DAT = value; }
        }
        public string AFN_SEM
        {
            get { return _AFN_SEM; }
            set { _AFN_SEM = value.ToUpper(); }
        }
        public int? AFN_TIP
        {
            get { return _AFN_TIP; }
            set { _AFN_TIP = value; }
        }
        public int? AFN_TIT_POY_ID
        {
            get { return _AFN_TIT_POY_ID; }
            set { _AFN_TIT_POY_ID = value; }
        }
        public string AFN_LOT
        {
            get { return _AFN_LOT; }
            set { _AFN_LOT = value.ToUpper(); }
        }
        public string AFN_MGE_001
        {
            get { return _AFN_MGE_001; }
            set { _AFN_MGE_001 = value.ToUpper(); }
        }
        public string AFN_MGE_002
        {
            get { return _AFN_MGE_002; }
            set { _AFN_MGE_002 = value.ToUpper(); }
        }
        public string AFN_MGE_003
        {
            get { return _AFN_MGE_003; }
            set { _AFN_MGE_003 = value.ToUpper(); }
        }
        public string AFN_MGE_004
        {
            get { return _AFN_MGE_004; }
            set { _AFN_MGE_004 = value.ToUpper(); }
        }
        public int? AFN_FOR_001_ID
        {
            get { return _AFN_FOR_001_ID; }
            set { _AFN_FOR_001_ID = value; }
        }
        public int? AFN_FOR_002_ID
        {
            get { return _AFN_FOR_002_ID; }
            set { _AFN_FOR_002_ID = value; }
        }
        public int? AFN_FOR_003_ID
        {
            get { return _AFN_FOR_003_ID; }
            set { _AFN_FOR_003_ID = value; }
        }
        public int? AFN_FOR_004_ID
        {
            get { return _AFN_FOR_004_ID; }
            set { _AFN_FOR_004_ID = value; }
        }
        public int? AFN_VLC
        {
            get { return _AFN_VLC; }
            set { _AFN_VLC = value; }
        }
        public int? AFN_APS_ID
        {
            get { return _AFN_APS_ID; }
            set { _AFN_APS_ID = value; }
        }
        public int? AFN_MAQ_TIP_ID
        {
            get { return _AFN_MAQ_TIP_ID; }
            set { _AFN_MAQ_TIP_ID = value; }
        }
        public int? AFN_MAQ_ID
        {
            get { return _AFN_MAQ_ID; }
            set { _AFN_MAQ_ID = value; }
        }
        public int? AFN_ERT_ID
        {
            get { return _AFN_ERT_ID; }
            set { _AFN_ERT_ID = value; }
        }
        public int? AFN_VRD
        {
            get { return _AFN_VRD; }
            set { _AFN_VRD = value; }
        }
        public int? AFN_BBN
        {
            get { return _AFN_BBN; }
            set { _AFN_BBN = value; }
        }
        public int? AFN_ANA_USR_ID
        {
            get { return _AFN_ANA_USR_ID; }
            set { _AFN_ANA_USR_ID = value; }
        }
        public double? AFN_CLO
        {
            get { return _AFN_CLO; }
            set { _AFN_CLO = value; }
        }
        public double? AFN_ESU
        {
            get { return _AFN_ESU; }
            set { _AFN_ESU = value; }
        }
        public double? AFN_TMT
        {
            get { return _AFN_TMT; }
            set { _AFN_TMT = value; }
        }
        public double? AFN_PMT
        {
            get { return _AFN_PMT; }
            set { _AFN_PMT = value; }
        }
        public double? AFN_PPF
        {
            get { return _AFN_PPF; }
            set { _AFN_PPF = value; }
        }
        public double? AFN_BBB
        {
            get { return _AFN_BBB; }
            set { _AFN_BBB = value; }
        }
        public double? AFN_PFE
        {
            get { return _AFN_PFE; }
            set { _AFN_PFE = value; }
        }
        public double? AFN_PSE
        {
            get { return _AFN_PSE; }
            set { _AFN_PSE = value; }
        }
        public double? AFN_LNE
        {
            get { return _AFN_LNE; }
            set { _AFN_LNE = value; }
        }
        public double? AFN_LNC
        {
            get { return _AFN_LNC; }
            set { _AFN_LNC = value; }
        }
        public double? AFN_ESL
        {
            get { return _AFN_ESL; }
            set { _AFN_ESL = value; }
        }
        public double? AFN_TOT
        {
            get { return _AFN_TOT; }
            set { _AFN_TOT = value; }
        }
        public int? AFN_STS
        {
            get { return _AFN_STS; }
            set { _AFN_STS = value; }
        }
        public int? AFN_USR_INC_ID
        {
            get { return _AFN_USR_INC_ID; }
            set { _AFN_USR_INC_ID = value; }
        }
        public int? AFN_USR_ALT_ID
        {
            get { return _AFN_USR_ALT_ID; }
            set { _AFN_USR_ALT_ID = value; }
        }
        public DateTime? AFN_TMS_ATL
        {
            get { return _AFN_TMS_ATL; }
            set { _AFN_TMS_ATL = value; }
        }

        public DateTime? AFN_DAT_INI
        {
            get { return _AFN_DAT_INI; }
            set { _AFN_DAT_INI = value; }
        }

        public DateTime? AFN_DAT_FIM
        {
            get { return _AFN_DAT_FIM; }
            set { _AFN_DAT_FIM = value; }
        }

        public string TOP
        {
            get { return _TOP; }
            set { _TOP = value; }
        }
        public string SQL
        {
            get { return _SQL; }
            set { _SQL = value; }
        }

        #endregion

        #region Métodos

        clsBanco dbConn = new clsBanco();

        public string Inserir()
        {
            string sSQL = "INSERT INTO AFN (";
            sSQL = sSQL + "AFN_DAT, ";
            sSQL = sSQL + "AFN_SEM, ";
            sSQL = sSQL + "AFN_TIP, ";
            sSQL = sSQL + "AFN_TIT_POY_ID, ";
            sSQL = sSQL + "AFN_LOT, ";
            sSQL = sSQL + "AFN_MGE_001, ";
            sSQL = sSQL + "AFN_MGE_002, ";
            sSQL = sSQL + "AFN_MGE_003, ";
            sSQL = sSQL + "AFN_MGE_004, ";
            sSQL = sSQL + "AFN_FOR_001_ID, ";
            sSQL = sSQL + "AFN_FOR_002_ID, ";
            sSQL = sSQL + "AFN_FOR_003_ID, ";
            sSQL = sSQL + "AFN_FOR_004_ID, ";
            //sSQL = sSQL + "AFN_VLC, ";
            sSQL = sSQL + "AFN_APS_ID, ";
            sSQL = sSQL + "AFN_MAQ_TIP_ID, ";
            sSQL = sSQL + "AFN_MAQ_ID, ";
            sSQL = sSQL + "AFN_ERT_ID, ";
            sSQL = sSQL + "AFN_VRD, ";
            sSQL = sSQL + "AFN_BBN, ";
            sSQL = sSQL + "AFN_ANA_USR_ID, ";
            sSQL = sSQL + "AFN_ANA_LEI_ID, ";
            sSQL = sSQL + "AFN_ANA_LIB_ID, ";
            //sSQL = sSQL + "AFN_CLO, ";
            //sSQL = sSQL + "AFN_ESU, ";
            //sSQL = sSQL + "AFN_TMT, ";
            //sSQL = sSQL + "AFN_PMT, ";
            //sSQL = sSQL + "AFN_PPF, ";
            //sSQL = sSQL + "AFN_BBB, ";
            //sSQL = sSQL + "AFN_PFE, ";
            //sSQL = sSQL + "AFN_PSE, ";
            //sSQL = sSQL + "AFN_LNE, ";
            //sSQL = sSQL + "AFN_LNC, ";
            //sSQL = sSQL + "AFN_ESL, ";
            //sSQL = sSQL + "AFN_TOT, ";
            //sSQL = sSQL + "AFN_DAT_MEIA, ";
            //sSQL = sSQL + "AFN_RES_MEIA, ";
            //sSQL = sSQL + "AFN_DAT_TIN, ";
            //sSQL = sSQL + "AFN_ANA_TIN_ID, ";
            //sSQL = sSQL + "AFN_DAT_LEI, ";
            //sSQL = sSQL + "AFN_ANA_LEI_ID, ";
            //sSQL = sSQL + "AFN_DAT_LIB, ";
            //sSQL = sSQL + "AFN_ANA_LIB_ID, ";
            sSQL = sSQL + "AFN_STS, ";
            sSQL = sSQL + "AFN_USR_INC_ID, ";
            sSQL = sSQL + "AFN_OBS, ";
            sSQL = sSQL + "AFN_GLA, ";
            sSQL = sSQL + "AFN_TMS_ATL) ";
            sSQL = sSQL + "VALUES (";
            if (!String.IsNullOrEmpty(AFN_DAT.ToString()))
            {
                sSQL = sSQL + "Convert(datetime, '" + AFN_DAT + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_SEM))
            {
                sSQL = sSQL + "'" + AFN_SEM.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TIP.ToString()))
            {
                sSQL = sSQL + AFN_TIP + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TIT_POY_ID.ToString()))
            {
                sSQL = sSQL + AFN_TIT_POY_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sSQL = sSQL + "'" + AFN_LOT.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_001))
            {
                sSQL = sSQL + "'" + AFN_MGE_001.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_002))
            {
                sSQL = sSQL + "'" + AFN_MGE_002.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_003))
            {
                sSQL = sSQL + "'" + AFN_MGE_003.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_004))
            {
                sSQL = sSQL + "'" + AFN_MGE_004.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_001_ID.ToString()))
            {
                sSQL = sSQL + AFN_FOR_001_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_002_ID.ToString()))
            {
                sSQL = sSQL + AFN_FOR_002_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_003_ID.ToString()))
            {
                sSQL = sSQL + AFN_FOR_003_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_004_ID.ToString()))
            {
                sSQL = sSQL + AFN_FOR_004_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            //if (!String.IsNullOrEmpty(AFN_VLC.ToString()))
            //{
            //    sSQL = sSQL + AFN_VLC + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            if (!String.IsNullOrEmpty(AFN_APS_ID.ToString()))
            {
                sSQL = sSQL + AFN_APS_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MAQ_TIP_ID.ToString()))
            {
                sSQL = sSQL + AFN_MAQ_TIP_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MAQ_ID.ToString()))
            {
                sSQL = sSQL + AFN_MAQ_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ERT_ID.ToString()))
            {
                sSQL = sSQL + AFN_ERT_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_VRD.ToString()))
            {
                sSQL = sSQL + AFN_VRD + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_BBN.ToString()))
            {
                sSQL = sSQL + AFN_BBN + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_USR_ID.ToString()))
            {
                sSQL = sSQL + 1 + ", ";
            }
            else
            {
                sSQL = sSQL + "1,";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_LEI_ID.ToString()))
            {
                sSQL = sSQL + AFN_ANA_LEI_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_LIB_ID.ToString()))
            {
                sSQL = sSQL + AFN_ANA_LIB_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }

            //if (!String.IsNullOrEmpty(AFN_CLO.ToString()))
            //{
            //    sSQL = sSQL + AFN_CLO.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_ESU.ToString()))
            //{
            //    sSQL = sSQL + AFN_ESU.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_TMT.ToString()))
            //{
            //    sSQL = sSQL + AFN_TMT.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_PMT.ToString()))
            //{
            //    sSQL = sSQL + AFN_PMT.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_PPF.ToString()))
            //{
            //    sSQL = sSQL + AFN_PPF.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_BBB.ToString()))
            //{
            //    sSQL = sSQL + AFN_BBB.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_PFE.ToString()))
            //{
            //    sSQL = sSQL + AFN_PFE.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_PSE.ToString()))
            //{
            //    sSQL = sSQL + AFN_PSE.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_LNE.ToString()))
            //{
            //    sSQL = sSQL + AFN_LNE.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_LNC.ToString()))
            //{
            //    sSQL = sSQL + AFN_LNC.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_ESL.ToString()))
            //{
            //    sSQL = sSQL + AFN_ESL.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_TOT.ToString()))
            //{
            //    sSQL = sSQL + AFN_TOT.ToString().Replace(",", ".") + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(AFN_DAT_MEIA.ToString()))
            //{
            //    sSQL = sSQL + "Convert(datetime, '" + AFN_DAT_MEIA + "', 103), ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            ////if (!String.IsNullOrEmpty(AFN_RES_MEIA.ToString()))
            //{
            //    sSQL = sSQL + "'" + AFN_RES_MEIA + "', ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(_AFN_DAT_TIN.ToString()))
            //{
            //    sSQL = sSQL + "Convert(datetime, '" + AFN_DAT_TIN + "', 103), ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(_AFN_ANA_TIN_ID.ToString()))
            //{
            //    sSQL = sSQL + "'" + AFN_ANA_TIN_ID + "', ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(_AFN_DAT_LEI.ToString()))
            //{
            //    sSQL = sSQL + "Convert(datetime, '" + AFN_DAT_LEI + "', 103), ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            //if (!String.IsNullOrEmpty(_AFN_DAT_LIB.ToString()))
            //{
            //    sSQL = sSQL + "Convert(datetime, '" + AFN_DAT_LIB + "', 103), ";
            //}
            //else
            //{
            //    sSQL = sSQL + "NULL, ";
            //}
            if (!String.IsNullOrEmpty(AFN_STS.ToString()))
            {
                sSQL = sSQL + AFN_STS + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_USR_INC_ID.ToString()))
            {
                sSQL = sSQL + AFN_USR_INC_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_OBS))
            {
                sSQL = sSQL + "'" + AFN_OBS + "', ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_GLA.ToString()))
            {
                sSQL = sSQL + AFN_GLA + ", ";
            }
            else
            {
                sSQL = sSQL + "NULL, ";
            }
            sSQL = sSQL + "GETDATE(), ";
            sSQL = sSQL.Substring(0, sSQL.Length - 2);
            sSQL = sSQL + ") ";

            SQL = sSQL;

            return dbConn.ExecutarInserir(sSQL);
        }

        public string Alterar()
        {
            string sSQL = "UPDATE AFN ";
            sSQL = sSQL + "SET ";
            if (!String.IsNullOrEmpty(AFN_DAT.ToString()))
            {
                sSQL = sSQL + "AFN_DAT = Convert(datetime, '" + AFN_DAT + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "AFN_DAT = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_SEM))
            {
                sSQL = sSQL + "AFN_SEM = '" + AFN_SEM.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_SEM = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TIP.ToString()))
            {
                sSQL = sSQL + "AFN_TIP = " + AFN_TIP + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_TIP = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TIT_POY_ID.ToString()))
            {
                sSQL = sSQL + "AFN_TIT_POY_ID = " + AFN_TIT_POY_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_TIT_POY_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sSQL = sSQL + "AFN_LOT = '" + AFN_LOT.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_LOT = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_001))
            {
                sSQL = sSQL + "AFN_MGE_001 = '" + AFN_MGE_001.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_MGE_001 = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_002))
            {
                sSQL = sSQL + "AFN_MGE_002 = '" + AFN_MGE_002.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_MGE_002 = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_003))
            {
                sSQL = sSQL + "AFN_MGE_003 = '" + AFN_MGE_003.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_MGE_003 = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_004))
            {
                sSQL = sSQL + "AFN_MGE_004 = '" + AFN_MGE_004.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_MGE_004 = NULL, ";
            } 
            if (!String.IsNullOrEmpty(AFN_FOR_001_ID.ToString()))
            {
                sSQL = sSQL + "AFN_FOR_001_ID = " + AFN_FOR_001_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_FOR_001_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_002_ID.ToString()))
            {
                sSQL = sSQL + "AFN_FOR_002_ID = " + AFN_FOR_002_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_FOR_002_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_003_ID.ToString()))
            {
                sSQL = sSQL + "AFN_FOR_003_ID = " + AFN_FOR_003_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_FOR_003_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_FOR_004_ID.ToString()))
            {
                sSQL = sSQL + "AFN_FOR_004_ID = " + AFN_FOR_004_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_FOR_004_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_VLC.ToString()))
            {
                sSQL = sSQL + "AFN_VLC = " + AFN_VLC + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_VLC = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_APS_ID.ToString()))
            {
                sSQL = sSQL + "AFN_APS_ID = " + AFN_APS_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_APS_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MAQ_TIP_ID.ToString()))
            {
                sSQL = sSQL + "AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_MAQ_TIP_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_MAQ_ID.ToString()))
            {
                sSQL = sSQL + "AFN_MAQ_ID = " + AFN_MAQ_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_MAQ_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ERT_ID.ToString()))
            {
                sSQL = sSQL + "AFN_ERT_ID = " + AFN_ERT_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ERT_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_VRD.ToString()))
            {
                sSQL = sSQL + "AFN_VRD = " + AFN_VRD + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_VRD = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_BBN.ToString()))
            {
                sSQL = sSQL + "AFN_BBN = " + AFN_BBN + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_BBN = NULL, ";
            }
            //if (!String.IsNullOrEmpty(AFN_ANA_USR_ID.ToString()))
            //{
            //    sSQL = sSQL + "AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + ", ";
            //}
            //else
            //{
            //    sSQL = sSQL + "AFN_ANA_USR_ID = NULL, ";
            //}
            if (!String.IsNullOrEmpty(AFN_CLO.ToString()))
            {
                sSQL = sSQL + "AFN_CLO = " + AFN_CLO.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_CLO = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ESU.ToString()))
            {
                sSQL = sSQL + "AFN_ESU = " + AFN_ESU.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ESU = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TMT.ToString()))
            {
                sSQL = sSQL + "AFN_TMT = " + AFN_TMT.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_TMT = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_PMT.ToString()))
            {
                sSQL = sSQL + "AFN_PMT = " + AFN_PMT.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_PMT = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_PPF.ToString()))
            {
                sSQL = sSQL + "AFN_PPF = " + AFN_PPF.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_PPF = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_BBB.ToString()))
            {
                sSQL = sSQL + "AFN_BBB = " + AFN_BBB.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_BBB = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_PFE.ToString()))
            {
                sSQL = sSQL + "AFN_PFE = " + AFN_PFE.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_PFE = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_PSE.ToString()))
            {
                sSQL = sSQL + "AFN_PSE = " + AFN_PSE.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_PSE = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_LNE.ToString()))
            {
                sSQL = sSQL + "AFN_LNE = " + AFN_LNE.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_LNE = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_LNC.ToString()))
            {
                sSQL = sSQL + "AFN_LNC = " + AFN_LNC.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_LNC = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ESL.ToString()))
            {
                sSQL = sSQL + "AFN_ESL = " + AFN_ESL.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ESL = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_TOT.ToString()))
            {
                sSQL = sSQL + "AFN_TOT = " + AFN_TOT.ToString().Replace(",", ".") + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_TOT = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_STS.ToString()))
            {
                sSQL = sSQL + "AFN_STS = " + AFN_STS + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_STS = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_DAT_MEIA.ToString()))
            {
                sSQL = sSQL + "AFN_DAT_MEIA = Convert(datetime, '" + AFN_DAT_MEIA + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "AFN_DAT_MEIA = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_RES_MEIA.ToString()))
            {
                sSQL = sSQL + "AFN_RES_MEIA = '" + AFN_RES_MEIA.Replace("'", "''") + "', ";
            }
            else
            {
                sSQL = sSQL + "AFN_RES_MEIA = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_DAT_TIN.ToString()))
            {
                sSQL = sSQL + "AFN_DAT_TIN = Convert(datetime, '" + AFN_DAT_TIN + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "AFN_DAT_TIN = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_TIN_ID.ToString()))
            {
                sSQL = sSQL + "AFN_ANA_TIN_ID = " + AFN_ANA_TIN_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ANA_TIN_ID = NULL, ";
            }

            if (!String.IsNullOrEmpty(AFN_DAT_LEI.ToString()))
            {
                sSQL = sSQL + "AFN_DAT_LEI = Convert(datetime, '" + AFN_DAT_LEI + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "AFN_DAT_LEI = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_LEI_ID.ToString()))
            {
                sSQL = sSQL + "AFN_ANA_LEI_ID = " + AFN_ANA_LEI_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ANA_LEI_ID = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_DAT_LIB.ToString()))
            {
                sSQL = sSQL + "AFN_DAT_LIB = Convert(datetime, '" + AFN_DAT_LIB + "', 103), ";
            }
            else
            {
                sSQL = sSQL + "AFN_DAT_LIB = NULL, ";
            }
            if (!String.IsNullOrEmpty(AFN_ANA_LIB_ID.ToString()))
            {
                sSQL = sSQL + "AFN_ANA_LIB_ID = " + AFN_ANA_LIB_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_ANA_LIB_ID = NULL, ";
            }

            if (!String.IsNullOrEmpty(AFN_USR_ALT_ID.ToString()))
            {
                sSQL = sSQL + "AFN_USR_ALT_ID = " + AFN_USR_ALT_ID + ", ";
            }
            else
            {
                sSQL = sSQL + "AFN_USR_ALT_ID = NULL, ";
            }

            sSQL = sSQL + "AFN_TMS_ATL =  GETDATE(), ";
            sSQL = sSQL.Substring(0, sSQL.Length - 2);
            sSQL = sSQL + " WHERE AFN_ID = " + AFN_ID;

            SQL = sSQL;

            return dbConn.ExecutarInserir(sSQL);

        }

        public string Excluir()
        {
            string sSQL = "DELETE FROM AFN";
            sSQL = sSQL + " WHERE AFN_ID = " + AFN_ID;

            SQL = sSQL;

            return dbConn.Executar(sSQL);

        }

        public DataSet Consultar()
        {
            string sCond = "";
            string sSQL = "";
            if (String.IsNullOrEmpty(Convert.ToString(TOP)))
            {
                sSQL = sSQL + " SELECT * ";
            }
            else
            {
                sSQL = sSQL + " SELECT TOP " + TOP.ToString() + " * ";
            }
            sSQL = sSQL + " FROM AFN";
            sSQL = sSQL + " INNER JOIN TIT_POY ON TIT_POY_ID = AFN_TIT_POY_ID";
            sSQL = sSQL + " INNER JOIN APS ON APS_ID = AFN_APS_ID";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID";
            //sSQL = sSQL + " INNER JOIN DEF ON DEF_AFN_ID = AFN_ID";
            //sSQL = sSQL + " INNER JOIN USR ON AFN_ANA_LEI_ID = USR_ID";
            //sSQL = sSQL + " INNER JOIN USR A  ON AFN_ANA_LIB_ID = A.USR_ID";
            //sSQL = sSQL + " INNER JOIN USR B ON AFN_ANA_TIN_ID = B.USR_ID";
            sSQL = sSQL + " LEFT JOIN ERT ON ERT_ID = AFN_ERT_ID";
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            //{
            //    sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            {
                sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            }
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //começa aqui
            if (!String.IsNullOrEmpty(AFN_SEM))
            {
                sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_001))
            {
                sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_002))
            {
                sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_003))
            {
                sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_004))
            {
                sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            {
                sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            {
                sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            {
                sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            {
                sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            {
                sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            {
                sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            {
                sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            {
                sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            {
                sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            {
                sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            }
            //termina aqui
            //Novas linhas Unifi - 03/07/13
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_RES_MEIA)))
            {
                sCond = sCond + " AFN_RES_MEIA = " + AFN_RES_MEIA + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_TIN_ID)))
            {
                sCond = sCond + " AFN_ANA_TIN_ID = " + AFN_ANA_TIN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LEI_ID)))
            {
                sCond = sCond + " AFN_ANA_LEI_ID = " + AFN_ANA_LEI_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LIB_ID)))
            {
                sCond = sCond + " AFN_ANA_LIB_ID = " + AFN_ANA_LIB_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_MEIA)))
            {
                sCond = sCond + " AFN_DAT_MEIA = " + AFN_DAT_MEIA + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_TIN)))
            {
                sCond = sCond + " AFN_DAT_TIN = " + AFN_DAT_TIN + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LEI)))
            {
                sCond = sCond + " AFN_DAT_LEI = " + AFN_DAT_LEI + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LIB)))
            {
                sCond = sCond + " AFN_DAT_LIB = " + AFN_DAT_LIB + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(DEF_POS)))
            //{
            //    sCond = sCond + " DEF_POS = " + DEF_POS + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DEF)))
            //{
            //    sCond = sCond + " AFN_DEF = " + AFN_DEF + " AND ";
            //}
            //Fim das novas linhas Unifi
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " ORDER BY AFN_DAT";

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet ConsultaDefeito()
        {
            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " SELECT AFN_ID,AFN_DAT,AFN_LOT,TIT_POY_DES,APS_DES,MAQ_DES,AFN_VRD,ERT_DES,AFN_OBS,AFN_GLA,DEF_POS,DEF_DES";
            sSQL = sSQL + " FROM AFN";
            sSQL = sSQL + " INNER JOIN TIT_POY ON TIT_POY_ID = AFN_TIT_POY_ID";
            sSQL = sSQL + " INNER JOIN APS ON APS_ID = AFN_APS_ID";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID";
            sSQL = sSQL + " INNER JOIN DEF ON DEF_AFN_ID = AFN_ID";
            sSQL = sSQL + " INNER JOIN ERT ON ERT_ID = AFN_ERT_ID";
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!string.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            sCond = sCond + " AFN_STS = 1  AND";
            sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND";
            sCond = sCond + " AFN_VRD = '" + AFN_VRD + "'";
            sSQL = sSQL + " WHERE " + sCond;
            sSQL = sSQL + " ORDER BY AFN_DAT DESC";
            SQL = sSQL;
            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet Consultar2()
        {
            string sCond = "";
            string sSQL = "";
            if (String.IsNullOrEmpty(Convert.ToString(TOP)))
            {
                sSQL = sSQL + " SELECT * ";
            }
            else
            {
                sSQL = sSQL + " SELECT TOP " + TOP.ToString() + " * ";
            }
            sSQL = sSQL + " FROM AFN";
            sSQL = sSQL + " INNER JOIN TIT_POY ON TIT_POY_ID = AFN_TIT_POY_ID";
            sSQL = sSQL + " INNER JOIN APS ON APS_ID = AFN_APS_ID";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID";
            sSQL = sSQL + " INNER JOIN DEF ON DEF_AFN_ID = AFN_ID";
            sSQL = sSQL + " INNER JOIN USR ON AFN_ANA_LEI_ID = USR_ID";
            sSQL = sSQL + " INNER JOIN USR A ON AFN_ANA_LIB_ID = A.USR_ID";
            //sSQL = sSQL + " INNER JOIN USR B ON AFN_ANA_TIN_ID = B.USR_ID";
            sSQL = sSQL + " LEFT JOIN ERT ON ERT_ID = AFN_ERT_ID";
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            //{
            //    sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            //}
            if (!string.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            //{
            //    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            //}
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_RES_MEIA)))
            //{
            //    sCond = sCond + " AFN_RES_MEIA = " + AFN_RES_MEIA + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_TIN_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_TIN_ID = " + AFN_ANA_TIN_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LEI_ID)))
            {
                sCond = sCond + " AFN_ANA_LEI_ID = " + AFN_ANA_LEI_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LIB_ID)))
            {
                sCond = sCond + " AFN_ANA_LIB_ID = " + AFN_ANA_LIB_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_MEIA)))
            //{
            //    sCond = sCond + " AFN_DAT_MEIA = " + AFN_DAT_MEIA + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_TIN)))
            //{
            //    sCond = sCond + " AFN_DAT_TIN = " + AFN_DAT_TIN + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LEI)))
            //{
            //    sCond = sCond + " AFN_DAT_LEI = " + AFN_DAT_LEI + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LIB)))
            //{
            //    sCond = sCond + " AFN_DAT_LIB = " + AFN_DAT_LIB + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = '" + AFN_VRD + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DEF)))
            {
                sCond = sCond + " DEF_DES = '" + AFN_DEF + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }
            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " ORDER BY AFN_DAT";

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet Consultar3()
        {
            string sCond = "";
            string sSQL = "";
            if (String.IsNullOrEmpty(Convert.ToString(TOP)))
            {
                sSQL = sSQL + " SELECT DEF_ID,AFN_DAT,AFN_SEM,TIT_POY_DES,AFN_LOT,APS_DES,MAQ_DES,AFN_ERT_ID,AFN_VRD,AFN_BBN,DEF_POS,DEF_DES,AFN_STS,A.USR_COD AS USR_LEI,B.USR_COD AS USR_LIB ";
            }
            else
            {
                sSQL = sSQL + " SELECT TOP " + TOP.ToString() + " * ";
            }
            sSQL = sSQL + " FROM AFN";
            sSQL = sSQL + " INNER JOIN TIT_POY ON TIT_POY_ID = AFN_TIT_POY_ID";
            sSQL = sSQL + " INNER JOIN APS ON APS_ID = AFN_APS_ID";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID";
            sSQL = sSQL + " INNER JOIN DEF ON DEF_AFN_ID = AFN_ID";
            sSQL = sSQL + " INNER JOIN USR A ON AFN_ANA_LEI_ID = A.USR_ID";
            sSQL = sSQL + " INNER JOIN USR B ON AFN_ANA_LIB_ID = B.USR_ID";
            //sSQL = sSQL + " INNER JOIN USR B ON AFN_ANA_TIN_ID = B.USR_ID";
            sSQL = sSQL + " LEFT JOIN ERT ON ERT_ID = AFN_ERT_ID";
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            //{
            //    sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            //}
            if (!string.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            //{
            //    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            //}
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_RES_MEIA)))
            //{
            //    sCond = sCond + " AFN_RES_MEIA = " + AFN_RES_MEIA + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_TIN_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_TIN_ID = " + AFN_ANA_TIN_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LEI_ID)))
            {
                sCond = sCond + " AFN_ANA_LEI_ID = " + AFN_ANA_LEI_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LIB_ID)))
            {
                sCond = sCond + " AFN_ANA_LIB_ID = " + AFN_ANA_LIB_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_MEIA)))
            //{
            //    sCond = sCond + " AFN_DAT_MEIA = " + AFN_DAT_MEIA + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_TIN)))
            //{
            //    sCond = sCond + " AFN_DAT_TIN = " + AFN_DAT_TIN + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LEI)))
            //{
            //    sCond = sCond + " AFN_DAT_LEI = " + AFN_DAT_LEI + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_LIB)))
            //{
            //    sCond = sCond + " AFN_DAT_LIB = " + AFN_DAT_LIB + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = '" + AFN_VRD + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DEF)))
            {
                sCond = sCond + " DEF_DES = '" + AFN_DEF + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }
            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " ORDER BY AFN_DAT";

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }










        public DataSet ConsultaPercentualVirada()
        {
            string sCond = "";
            string sSQL = "";
            //sSQL = sSQL + "SELECT AFN_LOT AS LOTE,AFN_MGE_001 AS MERGE,AFN_VRD AS VIRADA, ";
            sSQL = sSQL + "SELECT AFN_LOT AS LOTE,AFN_VRD AS VIRADA, ";
            sSQL = sSQL + "COUNT(DEF_DES) AS CNT,AFN_BBN AS BOBINAS FROM AFN ";
            sSQL = sSQL + "INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";
            //sSQL = sSQL + "INNER JOIN MAQ ON AFN_MAQ_ID = MAQ_ID";

            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_MGE_001))
            //{
            //    sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            //}

            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)) || !String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT_INI + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                //sSQL = sSQL + " WHERE AFN_BBN > 0 AND AFN_TIP = 'AFINIDADE' AND DEF_DES <> 'Sem def' AND " + sCond;
                sSQL = sSQL + " WHERE AFN_BBN > 0 AND AFN_TIP = 1 AND DEF_DES <> 'Sem def' AND " + sCond;
                //sSQL = sSQL + " GROUP BY AFN_VRD,AFN_LOT,AFN_MGE_001";
                sSQL = sSQL + " GROUP BY AFN_VRD,AFN_LOT,AFN_BBN";
                
            }

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }

        public DataSet ConsultaAnaMeia()
        {
            string sSQL = "";
            sSQL = sSQL + "SELECT DISTINCT AFN_RES_MEIA AS ANAMEIA ";
            sSQL = sSQL + "FROM AFN "; 
            sSQL = sSQL + "ORDER BY AFN_RES_MEIA";

            return dbConn.ExecutarRetorno(sSQL);
        }



 







        //}


        public DataSet ConsultarLote()
        {
            string sCond = "";
            string sSQL = "";

            sSQL = sSQL + " SELECT AFN_LOT,";
            sSQL = sSQL + " AFN_TIT_POY_ID,";
            sSQL = sSQL + " AFN_APS_ID,";
            sSQL = sSQL + " AFN_VLC,";
            sSQL = sSQL + " AFN_TIP,";
            sSQL = sSQL + " AFN_MGE_001,";
            sSQL = sSQL + " AFN_MGE_002,";
            sSQL = sSQL + " AFN_MGE_003,";
            sSQL = sSQL + " AFN_MGE_004,";
            sSQL = sSQL + " AFN_FOR_001_ID,";
            sSQL = sSQL + " AFN_FOR_002_ID,";
            sSQL = sSQL + " AFN_FOR_003_ID,";
            sSQL = sSQL + " AFN_FOR_004_ID, ";
            sSQL = sSQL + " AFN_DAT, ";
            sSQL = sSQL + " AFN_ERT_ID";
            sSQL = sSQL + " FROM AFN";

            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }


            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond + " ORDER BY AFN_DAT DESC";
            }

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }

        public DataSet ConsultarMedia()
        {
            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " SELECT COUNT(*) NUM,";
            sSQL = sSQL + " MIN(AFN_DAT) DAT_MIN, MAX(AFN_DAT) DAT_MAX,";
            sSQL = sSQL + " MIN(AFN_CLO) CLO_MIN, AVG(AFN_CLO) CLO_MED, MAX(AFN_CLO) CLO_MAX, ISNULL(STDEV(AFN_CLO),0) CLO_DSV,";
            sSQL = sSQL + " MIN(AFN_ESU) ESU_MIN, AVG(AFN_ESU) ESU_MED, MAX(AFN_ESU) ESU_MAX, ISNULL(STDEV(AFN_ESU),0) ESU_DSV,";
            sSQL = sSQL + " MIN(AFN_TMT) TMT_MIN, AVG(AFN_TMT) TMT_MED, MAX(AFN_TMT) TMT_MAX, ISNULL(STDEV(AFN_TMT),0) TMT_DSV,";
            sSQL = sSQL + " MIN(AFN_PMT) PMT_MIN, AVG(AFN_PMT) PMT_MED, MAX(AFN_PMT) PMT_MAX, ISNULL(STDEV(AFN_PMT),0) PMT_DSV,";
            sSQL = sSQL + " MIN(AFN_PPF) PPF_MIN, AVG(AFN_PPF) PPF_MED, MAX(AFN_PPF) PPF_MAX, ISNULL(STDEV(AFN_PPF),0) PPF_DSV,";
            sSQL = sSQL + " MIN(AFN_BBB) BBB_MIN, AVG(AFN_BBB) BBB_MED, MAX(AFN_BBB) BBB_MAX, ISNULL(STDEV(AFN_BBB),0) BBB_DSV,";
            sSQL = sSQL + " MIN(AFN_PFE) PFE_MIN, AVG(AFN_PFE) PFE_MED, MAX(AFN_PFE) PFE_MAX, ISNULL(STDEV(AFN_PFE),0) PFE_DSV,";
            sSQL = sSQL + " MIN(AFN_PSE) PSE_MIN, AVG(AFN_PSE) PSE_MED, MAX(AFN_PSE) PSE_MAX, ISNULL(STDEV(AFN_PSE),0) PSE_DSV,";
            sSQL = sSQL + " MIN(AFN_LNE) LNE_MIN, AVG(AFN_LNE) LNE_MED, MAX(AFN_LNE) LNE_MAX, ISNULL(STDEV(AFN_LNE),0) LNE_DSV,";
            sSQL = sSQL + " MIN(AFN_LNC) LNC_MIN, AVG(AFN_LNC) LNC_MED, MAX(AFN_LNC) LNC_MAX, ISNULL(STDEV(AFN_LNC),0) LNC_DSV,";
            sSQL = sSQL + " MIN(AFN_ESL) ESL_MIN, AVG(AFN_ESL) ESL_MED, MAX(AFN_ESL) ESL_MAX, ISNULL(STDEV(AFN_ESL),0) ESL_DSV,";
            sSQL = sSQL + " MIN(AFN_TOT) TOT_MIN, AVG(AFN_TOT) TOT_MED, MAX(AFN_TOT) TOT_MAX, ISNULL(STDEV(AFN_TOT),0) TOT_DSV ";
            sSQL = sSQL + " FROM AFN";



            //string sCond = "";
            //string sSQL = "";
            //sSQL = sSQL + " SELECT AFN_LOT LOTE,DEF_DES DEF,COUNT(DEF_DES) QTD ";
            //sSQL = sSQL + " FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";
            


            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(AFN_SEM))
            {
                sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            {
                sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIT_POY_ID)))
            {
                sCond = sCond + " AFN_TIT_POY_ID = " + AFN_TIT_POY_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_001))
            {
                sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_002))
            {
                sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_003))
            {
                sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_004))
            {
                sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            {
                sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            {
                sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            {
                sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            {
                sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            {
                sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            {
                sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            {
                sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            {
                sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            {
                sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            //sSQL = sSQL + " GROUP BY DEF_DES,AFN_LOT";
            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }





        public DataSet ConsultarMediaNovo2()
        {
            //string sCond = "";
            //string sSQL = "";
            //sSQL = sSQL + " SELECT COUNT(*) NUM,";
            //sSQL = sSQL + " MIN(AFN_DAT) DAT_MIN, MAX(AFN_DAT) DAT_MAX,";
            //sSQL = sSQL + " MIN(AFN_CLO) CLO_MIN, AVG(AFN_CLO) CLO_MED, MAX(AFN_CLO) CLO_MAX, ISNULL(STDEV(AFN_CLO),0) CLO_DSV,";
            //sSQL = sSQL + " MIN(AFN_ESU) ESU_MIN, AVG(AFN_ESU) ESU_MED, MAX(AFN_ESU) ESU_MAX, ISNULL(STDEV(AFN_ESU),0) ESU_DSV,";
            //sSQL = sSQL + " MIN(AFN_TMT) TMT_MIN, AVG(AFN_TMT) TMT_MED, MAX(AFN_TMT) TMT_MAX, ISNULL(STDEV(AFN_TMT),0) TMT_DSV,";
            //sSQL = sSQL + " MIN(AFN_PMT) PMT_MIN, AVG(AFN_PMT) PMT_MED, MAX(AFN_PMT) PMT_MAX, ISNULL(STDEV(AFN_PMT),0) PMT_DSV,";
            //sSQL = sSQL + " MIN(AFN_PPF) PPF_MIN, AVG(AFN_PPF) PPF_MED, MAX(AFN_PPF) PPF_MAX, ISNULL(STDEV(AFN_PPF),0) PPF_DSV,";
            //sSQL = sSQL + " MIN(AFN_BBB) BBB_MIN, AVG(AFN_BBB) BBB_MED, MAX(AFN_BBB) BBB_MAX, ISNULL(STDEV(AFN_BBB),0) BBB_DSV,";
            //sSQL = sSQL + " MIN(AFN_PFE) PFE_MIN, AVG(AFN_PFE) PFE_MED, MAX(AFN_PFE) PFE_MAX, ISNULL(STDEV(AFN_PFE),0) PFE_DSV,";
            //sSQL = sSQL + " MIN(AFN_PSE) PSE_MIN, AVG(AFN_PSE) PSE_MED, MAX(AFN_PSE) PSE_MAX, ISNULL(STDEV(AFN_PSE),0) PSE_DSV,";
            //sSQL = sSQL + " MIN(AFN_LNE) LNE_MIN, AVG(AFN_LNE) LNE_MED, MAX(AFN_LNE) LNE_MAX, ISNULL(STDEV(AFN_LNE),0) LNE_DSV,";
            //sSQL = sSQL + " MIN(AFN_LNC) LNC_MIN, AVG(AFN_LNC) LNC_MED, MAX(AFN_LNC) LNC_MAX, ISNULL(STDEV(AFN_LNC),0) LNC_DSV,";
            //sSQL = sSQL + " MIN(AFN_ESL) ESL_MIN, AVG(AFN_ESL) ESL_MED, MAX(AFN_ESL) ESL_MAX, ISNULL(STDEV(AFN_ESL),0) ESL_DSV,";
            //sSQL = sSQL + " MIN(AFN_TOT) TOT_MIN, AVG(AFN_TOT) TOT_MED, MAX(AFN_TOT) TOT_MAX, ISNULL(STDEV(AFN_TOT),0) TOT_DSV ";
            //sSQL = sSQL + " FROM AFN";
            


            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " select  afn_lot as lote,afn_vrd as virada,afn_bbn as bobina FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID ";
            //sSQL = sSQL + " Cast((Convert(decimal(10,5),(COUNT(DEF_DES)))/(Convert(decimal(10,5),(sum(AFN_BBN))))*100)AS decimal(4,2)) as Percentual";
            //sSQL = sSQL + " FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";



            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_SEM))
            //{
            //    sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            //{
            //    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIT_POY_ID)))
            //{
            //    sCond = sCond + " AFN_TIT_POY_ID = " + AFN_TIT_POY_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_MGE_001))
            //{
            //    sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_002))
            //{
            //    sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_003))
            //{
            //    sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_004))
            //{
            //    sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            //{
            //    sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            //{
            //    sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            //{
            //    sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            //{
            //    sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            //{
            //    sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            //{
            //    sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            //{
            //    sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " group by AFN_LOT,AFN_VRD,AFN_BBN";
            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }

        public DataSet ConsultarLotePercentual()
        {
            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " select AFN_LOT as LOTE,AFN_VRD as Virada,DEF_DES as DEFEITO,count(DEF_DES) as QTDDEF,sum(AFN_BBN) as SUMBBN from DEF inner join AFN on AFN_ID = DEF_AFN_ID ";
             
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " group by AFN_LOT,AFN_VRD,DEF_DES";
            sSQL = sSQL + " order by AFN_LOT";
            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet ConsultarMedia2()
        {
            //string sCond = "";
            //string sSQL = "";
            //sSQL = sSQL + " SELECT COUNT(*) NUM,";
            //sSQL = sSQL + " MIN(AFN_DAT) DAT_MIN, MAX(AFN_DAT) DAT_MAX,";
            //sSQL = sSQL + " MIN(AFN_CLO) CLO_MIN, AVG(AFN_CLO) CLO_MED, MAX(AFN_CLO) CLO_MAX, ISNULL(STDEV(AFN_CLO),0) CLO_DSV,";
            //sSQL = sSQL + " MIN(AFN_ESU) ESU_MIN, AVG(AFN_ESU) ESU_MED, MAX(AFN_ESU) ESU_MAX, ISNULL(STDEV(AFN_ESU),0) ESU_DSV,";
            //sSQL = sSQL + " MIN(AFN_TMT) TMT_MIN, AVG(AFN_TMT) TMT_MED, MAX(AFN_TMT) TMT_MAX, ISNULL(STDEV(AFN_TMT),0) TMT_DSV,";
            //sSQL = sSQL + " MIN(AFN_PMT) PMT_MIN, AVG(AFN_PMT) PMT_MED, MAX(AFN_PMT) PMT_MAX, ISNULL(STDEV(AFN_PMT),0) PMT_DSV,";
            //sSQL = sSQL + " MIN(AFN_PPF) PPF_MIN, AVG(AFN_PPF) PPF_MED, MAX(AFN_PPF) PPF_MAX, ISNULL(STDEV(AFN_PPF),0) PPF_DSV,";
            //sSQL = sSQL + " MIN(AFN_BBB) BBB_MIN, AVG(AFN_BBB) BBB_MED, MAX(AFN_BBB) BBB_MAX, ISNULL(STDEV(AFN_BBB),0) BBB_DSV,";
            //sSQL = sSQL + " MIN(AFN_PFE) PFE_MIN, AVG(AFN_PFE) PFE_MED, MAX(AFN_PFE) PFE_MAX, ISNULL(STDEV(AFN_PFE),0) PFE_DSV,";
            //sSQL = sSQL + " MIN(AFN_PSE) PSE_MIN, AVG(AFN_PSE) PSE_MED, MAX(AFN_PSE) PSE_MAX, ISNULL(STDEV(AFN_PSE),0) PSE_DSV,";
            //sSQL = sSQL + " MIN(AFN_LNE) LNE_MIN, AVG(AFN_LNE) LNE_MED, MAX(AFN_LNE) LNE_MAX, ISNULL(STDEV(AFN_LNE),0) LNE_DSV,";
            //sSQL = sSQL + " MIN(AFN_LNC) LNC_MIN, AVG(AFN_LNC) LNC_MED, MAX(AFN_LNC) LNC_MAX, ISNULL(STDEV(AFN_LNC),0) LNC_DSV,";
            //sSQL = sSQL + " MIN(AFN_ESL) ESL_MIN, AVG(AFN_ESL) ESL_MED, MAX(AFN_ESL) ESL_MAX, ISNULL(STDEV(AFN_ESL),0) ESL_DSV,";
            //sSQL = sSQL + " MIN(AFN_TOT) TOT_MIN, AVG(AFN_TOT) TOT_MED, MAX(AFN_TOT) TOT_MAX, ISNULL(STDEV(AFN_TOT),0) TOT_DSV ";
            //sSQL = sSQL + " FROM AFN";



            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " SELECT AFN_DAT DT,AFN_LOT LOTE,MAQ_DES MAQ,DEF_DES DEF,DEF_POS POS,AFN_VRD VIRADA,DEF_TIP TIPO,DEF_QTD QTD,AFN_BBN BBN ";
            sSQL = sSQL + " FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID ";



            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)) || (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM))))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT_INI + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            //{
            //    sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            //{
            //    sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_SEM))
            //{
            //    sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            //{
            //    //if (AFN_TIP == 0)
            //    //{
            //    //    sCond = sCond + " AFN_TIP = 1 OR AFN_TIP = 2 AND ";
            //    //}
            //    //else
            //    //{
            //        sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            //    //}
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIT_POY_ID)))
            //{
            //    sCond = sCond + " AFN_TIT_POY_ID = " + AFN_TIT_POY_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_MGE_001))
            //{
            //    sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_002))
            //{
            //    sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_003))
            //{
            //    sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_004))
            //{
            //    sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            //{
            //    sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            //{
            //    sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            {
                sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            //{
            //    sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            //{
            //    sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " ORDER BY AFN_LOT,AFN_DAT,AFN_VRD,BBN,DEF_DES";
            //SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet ConsultarDataHora()
        {


            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " SELECT AFN_DAT,AFN_LOT,AFN_VRD,AFN_TIP,SUM(AFN_BBN) AS QTD_BBN FROM AFN";
            //AFN_RES_MEIA,AFN_DAT_MEIA,C.USR_NOM AS RESTIN,AFN_DAT_TIN,";
            //sSQL = sSQL + " A.USR_NOM AS RESLEI,AFN_DAT_LEI,B.USR_NOM AS RESLIB,AFN_DAT_LIB FROM AFN 
            sSQL = sSQL + " INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID ";
            //sSQL = sSQL + " INNER JOIN USR AS A ON AFN_ANA_LEI_ID=A.USR_ID";
            //sSQL = sSQL + " INNER JOIN USR AS B ON AFN_ANA_LIB_ID=B.USR_ID INNER JOIN USR AS C ON AFN_ANA_TIN_ID=C.USR_ID";
            //sSQL = sSQL + " INNER JOIN USR AS D ON AFN_ANA_USR_ID=D.USR_ID  ";



            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_SEM))
            //{
            //    sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            {
                if (AFN_TIP.ToString() == "TODOS")
                {
                    AFN_TIP = 1;
                    sCond = sCond + " AFN_TIP = " + AFN_TIP + " OR ";
                    AFN_TIP = 2;
                    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
                }
                else if (AFN_TIP.ToString() == "AFNIDADE")
                {
                    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
                }
                else if (AFN_TIP.ToString() == "LUZ NEGRA")
                {
                    sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
                }
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIT_POY_ID)))
            //{
            //    sCond = sCond + " AFN_TIT_POY_ID = " + AFN_TIT_POY_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            //if (!String.IsNullOrEmpty(AFN_MGE_001))
            //{
            //    sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_002))
            //{
            //    sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_003))
            //{
            //    sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(AFN_MGE_004))
            //{
            //    sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            //{
            //    sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            //{
            //    sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            //{
            //    sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            //{
            //    sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            //{
            //    sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            //{
            //    sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_TIN_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_TIN_ID = " + AFN_ANA_TIN_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LEI_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_LEI_ID = " + AFN_ANA_LEI_ID + " AND ";
            //}
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_LIB_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_LIB_ID = " + AFN_ANA_LIB_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " GROUP BY AFN_DAT,AFN_LOT,AFN_VRD,AFN_TIP";
            //AFN_RES_MEIA,AFN_DAT_MEIA,C.USR_NOM,AFN_DAT_TIN,A.USR_NOM,AFN_DAT_LEI,B.USR_NOM,AFN_DAT_LIB";
            sSQL = sSQL + " ORDER BY AFN_DAT,AFN_LOT,AFN_VRD";
            //SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }






        public DataSet ConsultarDefeitoLote()
        {
            string sCond = "";
            string sSQL = "";
            //sSQL = sSQL + " Select afn_lot as Lote,cast(convert(decimal(5,2),(convert(float,(count(DEF_QTD)))/ CONVERT(float,(Select convert(float,sum(DEF_QTD)) from AFN inner join DEF on AFN_ID = DEF_afn_ID)))*100)as varchar(7)) + '%' as Percentual";
            //sSQL = sSQL + " FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";
            sSQL = sSQL + " SELECT AFN_LOT LOTE,DEF_DES DEF,DEF_POS POS,AFN_VRD VIRADA,DEF_TIP TIPO ";
            sSQL = sSQL + " FROM AFN INNER JOIN DEF ON AFN_ID = DEF_AFN_ID ";

            




            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            //sSQL = sSQL + " GROUP BY AFN_LOT,DEF_QTD";
            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }


        public DataSet ConsultarMediaMensal()
        {
            string sCond = "";
            string sSQL = "";
            sSQL = sSQL + " SELECT AFN_LOT, COUNT(*) NUM,";
            sSQL = sSQL + " MIN(AFN_CLO) CLO_MIN, AVG(AFN_CLO) CLO_MED, MAX(AFN_CLO) CLO_MAX, ISNULL(STDEV(AFN_CLO),0) CLO_DSV,";
            sSQL = sSQL + " MIN(AFN_ESU) ESU_MIN, AVG(AFN_ESU) ESU_MED, MAX(AFN_ESU) ESU_MAX, ISNULL(STDEV(AFN_ESU),0) ESU_DSV,";
            sSQL = sSQL + " MIN(AFN_TMT) TMT_MIN, AVG(AFN_TMT) TMT_MED, MAX(AFN_TMT) TMT_MAX, ISNULL(STDEV(AFN_TMT),0) TMT_DSV,";
            sSQL = sSQL + " MIN(AFN_PMT) PMT_MIN, AVG(AFN_PMT) PMT_MED, MAX(AFN_PMT) PMT_MAX, ISNULL(STDEV(AFN_PMT),0) PMT_DSV,";
            sSQL = sSQL + " MIN(AFN_PPF) PPF_MIN, AVG(AFN_PPF) PPF_MED, MAX(AFN_PPF) PPF_MAX, ISNULL(STDEV(AFN_PPF),0) PPF_DSV,";
            sSQL = sSQL + " MIN(AFN_BBB) BBB_MIN, AVG(AFN_BBB) BBB_MED, MAX(AFN_BBB) BBB_MAX, ISNULL(STDEV(AFN_BBB),0) BBB_DSV,";
            sSQL = sSQL + " MIN(AFN_PFE) PFE_MIN, AVG(AFN_PFE) PFE_MED, MAX(AFN_PFE) PFE_MAX, ISNULL(STDEV(AFN_PFE),0) PFE_DSV,";
            sSQL = sSQL + " MIN(AFN_PSE) PSE_MIN, AVG(AFN_PSE) PSE_MED, MAX(AFN_PSE) PSE_MAX, ISNULL(STDEV(AFN_PSE),0) PSE_DSV,";
            sSQL = sSQL + " MIN(AFN_LNE) LNE_MIN, AVG(AFN_LNE) LNE_MED, MAX(AFN_LNE) LNE_MAX, ISNULL(STDEV(AFN_LNE),0) LNE_DSV,";
            sSQL = sSQL + " MIN(AFN_LNC) LNC_MIN, AVG(AFN_LNC) LNC_MED, MAX(AFN_LNC) LNC_MAX, ISNULL(STDEV(AFN_LNC),0) LNC_DSV,";
            sSQL = sSQL + " MIN(AFN_ESL) ESL_MIN, AVG(AFN_ESL) ESL_MED, MAX(AFN_ESL) ESL_MAX, ISNULL(STDEV(AFN_ESL),0) ESL_DSV,";
            sSQL = sSQL + " MIN(AFN_TOT) TOT_MIN, AVG(AFN_TOT) TOT_MED, MAX(AFN_TOT) TOT_MAX, ISNULL(STDEV(AFN_TOT),0) TOT_DSV ";
            sSQL = sSQL + " FROM AFN";

            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ID)))
            {
                sCond = sCond + " AFN_ID = " + AFN_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(AFN_SEM))
            {
                sCond = sCond + " AFN_SEM = '" + AFN_SEM + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            {
                sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_001))
            {
                sCond = sCond + " AFN_MGE_001 = '" + AFN_MGE_001 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_002))
            {
                sCond = sCond + " AFN_MGE_002 = '" + AFN_MGE_002 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_003))
            {
                sCond = sCond + " AFN_MGE_003 = '" + AFN_MGE_003 + "' AND ";
            }
            if (!String.IsNullOrEmpty(AFN_MGE_004))
            {
                sCond = sCond + " AFN_MGE_004 = '" + AFN_MGE_004 + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_001_ID)))
            {
                sCond = sCond + " AFN_FOR_001_ID = " + AFN_FOR_001_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_002_ID)))
            {
                sCond = sCond + " AFN_FOR_002_ID = " + AFN_FOR_002_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_003_ID)))
            {
                sCond = sCond + " AFN_FOR_003_ID = " + AFN_FOR_003_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_FOR_004_ID)))
            {
                sCond = sCond + " AFN_FOR_004_ID = " + AFN_FOR_004_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VLC)))
            {
                sCond = sCond + " AFN_VLC = " + AFN_VLC + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_APS_ID)))
            {
                sCond = sCond + " AFN_APS_ID = " + AFN_APS_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_TIP_ID)))
            {
                sCond = sCond + " AFN_MAQ_TIP_ID = " + AFN_MAQ_TIP_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_ERT_ID)))
            {
                sCond = sCond + " AFN_ERT_ID = " + AFN_ERT_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_BBN)))
            {
                sCond = sCond + " AFN_BBN = " + AFN_BBN + " AND ";
            }
            //if (!String.IsNullOrEmpty(Convert.ToString(AFN_ANA_USR_ID)))
            //{
            //    sCond = sCond + " AFN_ANA_USR_ID = " + AFN_ANA_USR_ID + " AND ";
            //}
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " GROUP BY AFN_LOT";

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }

        public DataSet RelatorioAfinidadeVirada()
        {
            string sCond = "";
            string sSQL = "";
            if (String.IsNullOrEmpty(Convert.ToString(TOP)))
            {
                sSQL = sSQL + " SELECT ";
            }
            else
            {
                sSQL = sSQL + " SELECT TOP " + TOP.ToString() + " * ";
            }
            sSQL = sSQL + " AFN_DAT, AFN_LOT, MAQ_DES, AFN_VRD, SUM(AFN_BBN) AFN_BBN, SUM(AFN_DCL) AFN_DCL ";
            sSQL = sSQL + " FROM ";
            sSQL = sSQL + " (";
            sSQL = sSQL + " SELECt AFN_DAT, AFN_LOT, MAQ_DES, AFN_VRD, AFN_BBN, (SELECT COUNT(*) FROM DEF WHERE DEF_AFN_ID = AFN_ID AND DEF_DES != 'Sem def') AFN_DCL";
            sSQL = sSQL + " FROM AFN";
            sSQL = sSQL + " INNER JOIN MAQ ON MAQ_ID = AFN_MAQ_ID ";
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT)))
            {
                sCond = sCond + " AFN_DAT BETWEEN Convert(datetime, '" + AFN_DAT + "',103) AND Convert(datetime, '" + AFN_DAT_FIM + "',103) + 0.99999 AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_INI)))
            {
                sCond = sCond + " AFN_DAT >= Convert(datetime, '" + AFN_DAT_INI + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_DAT_FIM)))
            {
                sCond = sCond + " AFN_DAT <= Convert(datetime, '" + AFN_DAT_FIM + "',103) AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_TIP)))
            {
                sCond = sCond + " AFN_TIP = " + AFN_TIP + " AND ";
            }
            if (!String.IsNullOrEmpty(AFN_LOT))
            {
                sCond = sCond + " AFN_LOT = '" + AFN_LOT + "' AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_MAQ_ID)))
            {
                sCond = sCond + " AFN_MAQ_ID = " + AFN_MAQ_ID + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_VRD)))
            {
                sCond = sCond + " AFN_VRD = " + AFN_VRD + " AND ";
            }
            if (!String.IsNullOrEmpty(Convert.ToString(AFN_STS)))
            {
                sCond = sCond + " AFN_STS = " + AFN_STS + " AND ";
            }

            if (sCond != "")
            {
                sCond = sCond.Substring(1, sCond.Length - 5);
                sSQL = sSQL + " WHERE " + sCond;
            }
            sSQL = sSQL + " ) AFN_DET";
            sSQL = sSQL + " GROUP BY AFN_DAT, AFN_LOT, MAQ_DES, AFN_VRD";
            sSQL = sSQL + " ORDER BY AFN_DAT";

            SQL = sSQL;

            return dbConn.ExecutarRetorno(sSQL);
        }

        #endregion

    }
}
